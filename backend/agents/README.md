# æ™ºèƒ½ä½“ç³»ç»Ÿ - Agent with Tool Calling

## æ¦‚è¿°

åŸºäºOpenAIå·¥å…·è°ƒç”¨æ ‡å‡†å®ç°çš„æ™ºèƒ½ä½“ç³»ç»Ÿï¼Œæ”¯æŒæµå¼è¾“å‡ºã€å•è½®å’Œå¤šè½®å·¥å…·è°ƒç”¨ã€‚

## ç‰¹æ€§

- âœ… **æµå¼è¾“å‡º**: å®æ—¶æ˜¾ç¤ºå“åº”ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- âœ… **å·¥å…·è°ƒç”¨**: æ”¯æŒå•è½®å’Œå¤šè½®å·¥å…·è°ƒç”¨
- âœ… **æ™ºèƒ½åˆ¤æ–­**: è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦éœ€è¦è°ƒç”¨å·¥å…·
- âœ… **æ¨¡å—åŒ–è®¾è®¡**: æ˜“äºæ·»åŠ æ–°å·¥å…·
- âœ… **å®Œæ•´æµ‹è¯•**: åŒ…å«å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- âœ… **OpenAIæ ‡å‡†**: éµå¾ªOpenAIå·¥å…·å®šä¹‰æ ¼å¼

## é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ agents/                      # æ™ºèƒ½ä½“æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py             # æ¨¡å—å¯¼å‡º
â”‚   â”œâ”€â”€ agent.py                # æ™ºèƒ½ä½“æ ¸å¿ƒå®ç°
â”‚   â”œâ”€â”€ tools.py                # å·¥å…·æ³¨å†Œå’Œç®¡ç†
â”‚   â””â”€â”€ rss_tools.py            # RSSå·¥å…·é›†æˆ
â”œâ”€â”€ tests/                       # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ test_agent.py           # å®Œæ•´æµ‹è¯•å¥—ä»¶
â”‚   â””â”€â”€ test_agent_simple.py    # å¿«é€ŸéªŒè¯æµ‹è¯•
â””â”€â”€ tools/                       # å·¥å…·å®ç°
    â””â”€â”€ rss_fetcher/            # RSSè·å–å·¥å…·
```

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
cd backend
source .venv/bin/activate
pip install openai python-dotenv
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

åœ¨é¡¹ç›®æ ¹ç›®å½•çš„`.env`æ–‡ä»¶ä¸­é…ç½®ï¼š
```env
QWEN_API_KEY=your_api_key
QWEN_API_BASE_URL=http://your_api_url
```

### 3. è¿è¡Œæµ‹è¯•

```bash
# å¿«é€Ÿæµ‹è¯•ï¼ˆæ¨èï¼‰
python3 tests/test_agent_simple.py

# å®Œæ•´æµ‹è¯•
python3 tests/test_agent.py
```

## ä½¿ç”¨ç¤ºä¾‹

### åˆ›å»ºæ™ºèƒ½ä½“

```python
from agents import Agent, AgentConfig
from agents.rss_tools import RSS_TOOLS_DEFINITIONS
import os

# åˆ›å»ºé…ç½®
config = AgentConfig(
    model="qwen3-235b-instruct",
    api_key=os.getenv("QWEN_API_KEY"),
    base_url=os.getenv("QWEN_API_BASE_URL"),
    system_prompt="ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½æ–°é—»åŠ©æ‰‹...",
    max_tool_iterations=5
)

# åˆ›å»ºæ™ºèƒ½ä½“
agent = Agent(config)

# æ³¨å†ŒRSSå·¥å…·
for tool_def in RSS_TOOLS_DEFINITIONS:
    agent.register_tool(
        name=tool_def["name"],
        description=tool_def["description"],
        parameters=tool_def["parameters"],
        function=tool_def["function"]
    )
```

### æµå¼å¯¹è¯

```python
messages = [{"role": "user", "content": "å¸®æˆ‘æ‰¾ä¸€äº›AIç›¸å…³çš„æ–°é—»"}]

for chunk in agent.chat_stream(messages):
    if chunk["type"] == "text":
        print(chunk["content"], end="", flush=True)
    elif chunk["type"] == "tool_call":
        print(f"\nğŸ”§ è°ƒç”¨å·¥å…·: {chunk['tool_name']}")
    elif chunk["type"] == "tool_result":
        print(f"âœ… å·¥å…·æ‰§è¡Œå®Œæˆ")
```

## å¯ç”¨å·¥å…·

### 1. fetch_rss_news
è·å–æœ€æ–°RSSæ–°é—»

**å‚æ•°**:
- `max_articles` (å¯é€‰): æœ€å¤§æ–‡ç« æ•°
- `sources_limit` (å¯é€‰): é™åˆ¶RSSæºæ•°é‡

**ç¤ºä¾‹é—®é¢˜**:
- "å¸®æˆ‘è·å–æœ€æ–°çš„æ–°é—»ï¼Œæœ€å¤š20æ¡"
- "ç»™æˆ‘çœ‹çœ‹ä»Šå¤©çš„èµ„è®¯"

### 2. filter_rss_news
æ ¹æ®æŸ¥è¯¢ç­›é€‰RSSæ–°é—»

**å‚æ•°**:
- `query` (å¿…éœ€): æŸ¥è¯¢å…³é”®è¯æˆ–é—®é¢˜
- `max_articles` (å¯é€‰): æœ€å¤§è·å–æ–‡ç« æ•°ï¼Œé»˜è®¤50
- `top_k` (å¯é€‰): è¿”å›å‰kç¯‡ï¼Œé»˜è®¤10

**ç¤ºä¾‹é—®é¢˜**:
- "æ‰¾ä¸€äº›å…³äºAIçš„æ–°é—»"
- "ç»™æˆ‘çœ‹çœ‹ç§‘æŠ€ç›¸å…³çš„èµ„è®¯"

### 3. search_rss_by_keywords
æ ¹æ®å…³é”®è¯åˆ—è¡¨æœç´¢RSSæ–°é—»

**å‚æ•°**:
- `keywords` (å¿…éœ€): å…³é”®è¯åˆ—è¡¨
- `max_articles` (å¯é€‰): æœ€å¤§è·å–æ–‡ç« æ•°ï¼Œé»˜è®¤50

**ç¤ºä¾‹é—®é¢˜**:
- "æœç´¢åŒ…å«'AI'ã€'äººå·¥æ™ºèƒ½'çš„æ–°é—»"
- "æŸ¥æ‰¾å…³é”®è¯ä¸º'èŠ¯ç‰‡'çš„èµ„è®¯"

## æ ¸å¿ƒæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·è¯·æ±‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Agent       â”‚ â—„â”€â”€â”€â”€â”€â”€â”
â”‚  - æµå¼å¯¹è¯     â”‚        â”‚
â”‚  - å·¥å…·è°ƒç”¨     â”‚        â”‚ å¤šè½®è¿­ä»£
â”‚  - è¿­ä»£æ§åˆ¶     â”‚        â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â”‚
     â”‚      â”‚              â”‚
     â–¼      â–¼              â”‚
â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”          â”‚
â”‚Toolsâ”‚  â”‚ LLM â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜
```

## å·¥å…·è°ƒç”¨æµç¨‹

1. ç”¨æˆ·å‘é€æ¶ˆæ¯
2. Agentè°ƒç”¨LLMï¼ˆå¸¦å·¥å…·å®šä¹‰ï¼‰
3. LLMåˆ¤æ–­æ˜¯å¦éœ€è¦è°ƒç”¨å·¥å…·
4. å¦‚æœéœ€è¦ï¼Œæ‰§è¡Œå·¥å…·å¹¶è·å–ç»“æœ
5. å°†å·¥å…·ç»“æœæ·»åŠ åˆ°å¯¹è¯å†å²
6. é‡å¤æ­¥éª¤2-5ï¼Œç›´åˆ°LLMç»™å‡ºæœ€ç»ˆç­”æ¡ˆ

## æµ‹è¯•ç»“æœ

### âœ… æµ‹è¯•1: æ™®é€šå¯¹è¯ï¼ˆä¸éœ€è¦å·¥å…·ï¼‰
```
ç”¨æˆ·: ä½ å¥½ï¼Œä½ èƒ½åšä»€ä¹ˆï¼Ÿ
åŠ©æ‰‹: ä½ å¥½ï¼æˆ‘æ˜¯ä¸€ä¸ªæ™ºèƒ½æ–°é—»åŠ©æ‰‹ï¼Œå¯ä»¥å¸®åŠ©ä½ è·å–å’Œåˆ†ææœ€æ–°çš„èµ„è®¯...
```

### âœ… æµ‹è¯•2: å•è½®å·¥å…·è°ƒç”¨
```
ç”¨æˆ·: å¸®æˆ‘è·å–10æ¡æœ€æ–°æ–°é—»
åŠ©æ‰‹: 
ğŸ”§ è°ƒç”¨å·¥å…·: fetch_rss_news
âœ… å·¥å…·æ‰§è¡ŒæˆåŠŸ
ä»¥ä¸‹æ˜¯ä¸ºæ‚¨è·å–çš„10æ¡æœ€æ–°æ–°é—»...
```

### âœ… æµ‹è¯•3: æ™ºèƒ½ç­›é€‰
```
ç”¨æˆ·: æ‰¾ä¸€äº›å…³äºAIçš„æ–°é—»
åŠ©æ‰‹:
ğŸ”§ è°ƒç”¨å·¥å…·: filter_rss_news
âœ… å·¥å…·æ‰§è¡ŒæˆåŠŸ
ä»¥ä¸‹æ˜¯å…³äºAIå’Œäººå·¥æ™ºèƒ½çš„ç›¸å…³æ–°é—»ï¼š
1. 2025å¹´ä»¥æ¥å®å¤ç´¯è®¡åŸ¹è‚²äººå·¥æ™ºèƒ½ç›¸å…³ä¼ä¸š150å®¶
...
```

## æ€§èƒ½ç‰¹æ€§

- **å¹¶å‘è·å–**: RSS fetcherä½¿ç”¨10ä¸ªçº¿ç¨‹å¹¶å‘è·å–æ–°é—»
- **è¶…æ—¶æ§åˆ¶**: æ¯ä¸ªRSSæº10ç§’è¶…æ—¶
- **å¤±è´¥é‡è¯•**: æœ€å¤šé‡è¯•2æ¬¡
- **æµå¼ä¼˜åŒ–**: ä½¿ç”¨Generatoré¿å…å†…å­˜å ç”¨

## æ‰©å±•æ€§

### æ·»åŠ æ–°å·¥å…·

1. å®šä¹‰å·¥å…·å‡½æ•°
2. å®šä¹‰OpenAIæ ¼å¼çš„å·¥å…·æè¿°
3. æ³¨å†Œåˆ°æ™ºèƒ½ä½“

```python
def my_tool(param: str) -> dict:
    return {"result": "..."}

tool_def = {
    "name": "my_tool",
    "description": "å·¥å…·æè¿°",
    "parameters": {...},
    "function": my_tool
}

agent.register_tool(**tool_def)
```

### åˆ‡æ¢ä¸åŒæ¨¡å‹

åªéœ€ä¿®æ”¹é…ç½®ï¼š
```python
config = AgentConfig(
    model="gpt-4",
    api_key="sk-...",
    base_url="https://api.openai.com/v1"
)
```

## æ–‡æ¡£

- [å®Œæ•´è®¾è®¡æ–‡æ¡£](docs/backend/agent_system_design.md)
- [ä½¿ç”¨æŒ‡å—](docs/backend/agent_usage_guide.md)

## æŠ€æœ¯æ ˆ

- **Python 3.10+**
- **OpenAI Python SDK**: LLM APIè°ƒç”¨
- **RSS Fetcher**: RSSæ–°é—»è·å–
- **Dataclasses**: æ•°æ®æ¨¡å‹
- **Threading**: å¹¶å‘å¤„ç†

## æ³¨æ„äº‹é¡¹

- APIå¯†é’¥åº”å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡ä¸­ï¼Œä¸è¦ç¡¬ç¼–ç 
- å·¥å…·æ‰§è¡Œéƒ½åŒ…è£…åœ¨try-exceptä¸­ï¼Œç¡®ä¿å®‰å…¨
- é™åˆ¶æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œé¿å…æ— é™å¾ªç¯
- å·¥å…·ç»“æœè¿‡é•¿æ—¶ä¼šè‡ªåŠ¨æˆªæ–­

## åç»­ä¼˜åŒ–

- [ ] æ·»åŠ å·¥å…·è°ƒç”¨ç»Ÿè®¡å’Œåˆ†æ
- [ ] å®ç°å·¥å…·ç»“æœç¼“å­˜
- [ ] æ”¯æŒå¹¶è¡Œå·¥å…·è°ƒç”¨
- [ ] æ·»åŠ æ›´å¤šå·¥å…·ï¼ˆæœç´¢ã€è®¡ç®—ç­‰ï¼‰
- [ ] å®ç°Agentè®°å¿†ç³»ç»Ÿ
- [ ] æ”¯æŒå¤šAgentåä½œ

## è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

## è®¸å¯è¯

MIT License
