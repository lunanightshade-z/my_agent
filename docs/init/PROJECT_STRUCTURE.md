# é¡¹ç›®ç»“æ„æ€»è§ˆ

```
building_agent/
â”‚
â”œâ”€â”€ ğŸ“ backend/                          # FastAPI åç«¯
â”‚   â”œâ”€â”€ __init__.py                     # Python åŒ…åˆå§‹åŒ–
â”‚   â”œâ”€â”€ main.py                         # â­ FastAPI ä¸»åº”ç”¨
â”‚   â”œâ”€â”€ models.py                       # ğŸ“Š æ•°æ®åº“æ¨¡å‹ï¼ˆConversation, Messageï¼‰
â”‚   â”œâ”€â”€ database.py                     # ğŸ—„ï¸ æ•°æ®åº“é…ç½®ï¼ˆSQLAlchemyï¼‰
â”‚   â”œâ”€â”€ zhipu_service.py                # ğŸ¤– æ™ºè°±AIæœåŠ¡ï¼ˆæµå¼å“åº”ï¼‰
â”‚   â”œâ”€â”€ schemas.py                      # ğŸ“‹ Pydantic æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ requirements.txt                # ğŸ“¦ Python ä¾èµ–æ¸…å•
â”‚
â”œâ”€â”€ ğŸ“ frontend/                         # React å‰ç«¯
â”‚   â”œâ”€â”€ ğŸ“ src/
â”‚   â”‚   â”œâ”€â”€ ğŸ“ components/              # React ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatHistory.jsx        # ğŸ“œ å·¦ä¾§å†å²é¢æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatMain.jsx           # ğŸ’¬ ä¸»èŠå¤©ç•Œé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ MessageBubble.jsx      # ğŸ’­ æ¶ˆæ¯æ°”æ³¡ï¼ˆMarkdownæ¸²æŸ“ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ InputBox.jsx           # âŒ¨ï¸ è¾“å…¥æ¡†ï¼ˆthinkingåˆ‡æ¢ï¼‰
â”‚   â”‚   â”œâ”€â”€ ğŸ“ store/
â”‚   â”‚   â”‚   â””â”€â”€ store.js               # ğŸª Redux çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ ğŸ“ services/
â”‚   â”‚   â”‚   â””â”€â”€ api.js                 # ğŸŒ API æœåŠ¡ï¼ˆSSEå¤„ç†ï¼‰
â”‚   â”‚   â”œâ”€â”€ App.jsx                    # ğŸ¯ ä¸»åº”ç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ main.jsx                   # ğŸš€ åº”ç”¨å…¥å£
â”‚   â”‚   â””â”€â”€ index.css                  # ğŸ¨ å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ index.html                     # ğŸ“„ HTML æ¨¡æ¿
â”‚   â”œâ”€â”€ package.json                   # ğŸ“¦ Node.js é¡¹ç›®é…ç½®
â”‚   â”œâ”€â”€ vite.config.js                 # âš¡ Vite æ„å»ºé…ç½®
â”‚   â”œâ”€â”€ tailwind.config.js             # ğŸ¨ Tailwind CSS é…ç½®
â”‚   â””â”€â”€ postcss.config.js              # ğŸ”§ PostCSS é…ç½®
â”‚
â”œâ”€â”€ ğŸ“„ .env                             # ğŸ” ç¯å¢ƒå˜é‡ï¼ˆéœ€é…ç½®ï¼‰
â”œâ”€â”€ ğŸ“„ .gitignore                       # ğŸš« Git å¿½ç•¥è§„åˆ™
â”‚
â”œâ”€â”€ ğŸ“– README.md                        # ğŸ“š å®Œæ•´é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ ğŸ“– QUICKSTART.md                    # ğŸš€ å¿«é€Ÿå¼€å§‹æŒ‡å—
â”œâ”€â”€ ğŸ“– TODO.md                          # âœ… åŠŸèƒ½è§„åˆ’
â”œâ”€â”€ ğŸ“– PROJECT_DELIVERY.md              # ğŸ“¦ äº¤ä»˜æ–‡æ¡£
â”‚
â”œâ”€â”€ ğŸ”§ check_system.py                  # âœ”ï¸ ç³»ç»Ÿé…ç½®æ£€æŸ¥
â”‚
â”œâ”€â”€ ğŸªŸ start_backend.bat                # Windows åç«¯å¯åŠ¨
â”œâ”€â”€ ğŸªŸ start_frontend.bat               # Windows å‰ç«¯å¯åŠ¨
â”œâ”€â”€ ğŸ§ start_backend.sh                 # Unix/Linux åç«¯å¯åŠ¨
â”œâ”€â”€ ğŸ§ start_frontend.sh                # Unix/Linux å‰ç«¯å¯åŠ¨
â”‚
â”œâ”€â”€ ğŸ““ test_zhipu_api.py                # åŸå§‹æµ‹è¯•ä»£ç ï¼ˆä¿ç•™ï¼‰
â””â”€â”€ ğŸ““ test_zhipu_api.ipynb             # åŸå§‹Jupyterç¬”è®°æœ¬ï¼ˆä¿ç•™ï¼‰
```

## ğŸ¯ æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

### åç«¯æ ¸å¿ƒ

#### `backend/main.py` (216è¡Œ)
- FastAPI åº”ç”¨åˆå§‹åŒ–
- CORS é…ç½®
- æ‰€æœ‰ API ç«¯ç‚¹å®ç°
- SSE æµå¼å“åº”å¤„ç†

#### `backend/models.py` (48è¡Œ)
- `Conversation` æ¨¡å‹ï¼šä¼šè¯è¡¨
- `Message` æ¨¡å‹ï¼šæ¶ˆæ¯è¡¨
- å…³ç³»æ˜ å°„é…ç½®

#### `backend/zhipu_service.py` (88è¡Œ)
- æ™ºè°±AIå®¢æˆ·ç«¯å°è£…
- å¼‚æ­¥æµå¼ç”Ÿæˆå™¨
- thinking æ¨¡å¼æ”¯æŒ

### å‰ç«¯æ ¸å¿ƒ

#### `frontend/src/components/ChatMain.jsx` (134è¡Œ)
- ä¸»èŠå¤©ç•Œé¢
- æ¶ˆæ¯åˆ—è¡¨æ¸²æŸ“
- æµå¼å“åº”å¤„ç†
- ç©ºçŠ¶æ€å±•ç¤º

#### `frontend/src/components/ChatHistory.jsx` (157è¡Œ)
- å·¦ä¾§å†å²é¢æ¿
- ä¼šè¯åˆ—è¡¨ç®¡ç†
- åˆ›å»º/åˆ é™¤/åˆ‡æ¢å¯¹è¯

#### `frontend/src/components/MessageBubble.jsx` (103è¡Œ)
- æ¶ˆæ¯æ°”æ³¡ç»„ä»¶
- Markdown æ¸²æŸ“
- ä»£ç è¯­æ³•é«˜äº®
- ç”¨æˆ·/AI æ ·å¼åŒºåˆ†

#### `frontend/src/store/store.js` (147è¡Œ)
- Redux Toolkit é…ç½®
- çŠ¶æ€åˆ‡ç‰‡å®šä¹‰
- æ‰€æœ‰ actions å’Œ reducers

#### `frontend/src/services/api.js` (127è¡Œ)
- Axios å®¢æˆ·ç«¯é…ç½®
- æ‰€æœ‰ API è°ƒç”¨å°è£…
- SSE æµå¼å¤„ç†

## ğŸ“Š æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ç”¨æˆ·æµè§ˆå™¨                          â”‚
â”‚  http://localhost:5173                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         React å‰ç«¯ (Vite)                       â”‚
â”‚  - Redux (çŠ¶æ€ç®¡ç†)                             â”‚
â”‚  - TailwindCSS (æ ·å¼)                          â”‚
â”‚  - Framer Motion (åŠ¨ç”»)                        â”‚
â”‚  - React Markdown (æ¸²æŸ“)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ HTTP/SSE
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       FastAPI åç«¯ (Uvicorn)                    â”‚
â”‚  http://localhost:8000                          â”‚
â”‚  - RESTful API                                  â”‚
â”‚  - SSE æµå¼ä¼ è¾“                                 â”‚
â”‚  - SQLAlchemy ORM                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚             â”‚
             â–¼             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ SQLite DB  â”‚  â”‚  æ™ºè°±AI API  â”‚
    â”‚ æœ¬åœ°å­˜å‚¨   â”‚  â”‚  GLM-4-Flash â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¨ UI ç»„ä»¶å±‚æ¬¡

```
App.jsx
â”œâ”€â”€ Provider (Redux)
â””â”€â”€ Layout
    â”œâ”€â”€ ChatHistory (å·¦ä¾§ï¼Œå®½åº¦ 320px)
    â”‚   â”œâ”€â”€ æ–°å»ºå¯¹è¯æŒ‰é’®
    â”‚   â””â”€â”€ ä¼šè¯åˆ—è¡¨
    â”‚       â””â”€â”€ ä¼šè¯é¡¹ (å¯ç‚¹å‡»ã€å¯åˆ é™¤)
    â”‚
    â””â”€â”€ ChatMain (å³ä¾§ï¼Œflex-1)
        â”œâ”€â”€ æ¶ˆæ¯åˆ—è¡¨åŒºåŸŸ
        â”‚   â””â”€â”€ MessageBubble[] (ç”¨æˆ·/AIæ¶ˆæ¯)
        â”‚       â”œâ”€â”€ å¤´åƒ
        â”‚       â”œâ”€â”€ å†…å®¹ (Markdownæ¸²æŸ“)
        â”‚       â””â”€â”€ ä»£ç é«˜äº®
        â”‚
        â””â”€â”€ InputBox (åº•éƒ¨å›ºå®š)
            â”œâ”€â”€ Thinking æ¨¡å¼å¼€å…³
            â”œâ”€â”€ å¤šè¡Œæ–‡æœ¬æ¡†
            â””â”€â”€ å‘é€æŒ‰é’®
```

## ğŸ“¡ æ•°æ®æµ

### å‘é€æ¶ˆæ¯æµç¨‹
```
1. ç”¨æˆ·è¾“å…¥ â†’ InputBox
2. ç‚¹å‡»å‘é€ â†’ dispatch(addUserMessage)
3. è°ƒç”¨ API â†’ sendMessageStream()
4. åç«¯æ¥æ”¶ â†’ FastAPI /api/chat/stream
5. è°ƒç”¨æ™ºè°± â†’ zhipu_service.get_zhipu_stream_response()
6. æµå¼è¿”å› â†’ SSE chunks
7. å‰ç«¯æ¥æ”¶ â†’ dispatch(appendStreamingContent)
8. å®æ—¶æ›´æ–° â†’ MessageBubble æ˜¾ç¤º
9. å®Œæˆå â†’ dispatch(endStreaming)
10. ä¿å­˜æ•°æ®åº“ â†’ SQLite
```

### åŠ è½½å†å²æµç¨‹
```
1. é€‰æ‹©ä¼šè¯ â†’ ChatHistory onClick
2. åˆ‡æ¢ä¼šè¯ â†’ dispatch(setCurrentConversation)
3. è¯·æ±‚å†å² â†’ getConversationMessages(id)
4. åç«¯æŸ¥è¯¢ â†’ SQLAlchemy query
5. è¿”å›æ¶ˆæ¯ â†’ JSON response
6. æ›´æ–°çŠ¶æ€ â†’ dispatch(setMessages)
7. æ¸²æŸ“åˆ—è¡¨ â†’ ChatMain æ˜¾ç¤º
```

## ğŸ”§ é…ç½®æ–‡ä»¶å…³ç³»

```
.env
 â””â”€â”€ ZHIPU_API_KEY
      â†“
backend/zhipu_service.py
 â””â”€â”€ ZhipuAiClient(api_key)
      â†“
backend/main.py
 â””â”€â”€ /api/chat/stream
      â†“
frontend/src/services/api.js
 â””â”€â”€ sendMessageStream()
      â†“
frontend/src/components/ChatMain.jsx
 â””â”€â”€ handleSendMessage()
```

## ğŸ“¦ ä¾èµ–å…³ç³»

### åç«¯ä¾èµ–é“¾
```
main.py
â”œâ”€â”€ models.py â†’ database.py
â”œâ”€â”€ schemas.py
â””â”€â”€ zhipu_service.py
    â””â”€â”€ zai (æ™ºè°±SDK)
```

### å‰ç«¯ä¾èµ–é“¾
```
main.jsx
â””â”€â”€ App.jsx
    â”œâ”€â”€ store.js (Redux)
    â””â”€â”€ components/
        â”œâ”€â”€ ChatHistory.jsx â†’ api.js, store.js
        â”œâ”€â”€ ChatMain.jsx â†’ api.js, store.js, InputBox.jsx, MessageBubble.jsx
        â”œâ”€â”€ MessageBubble.jsx â†’ react-markdown, react-syntax-highlighter
        â””â”€â”€ InputBox.jsx â†’ store.js
```

---

**å®Œæ•´é¡¹ç›®å·²äº¤ä»˜ï¼** âœ…

æ‰€æœ‰æ–‡ä»¶å·²åˆ›å»ºå®Œæˆï¼Œé¡¹ç›®ç»“æ„æ¸…æ™°ï¼Œä»£ç è§„èŒƒï¼Œæ–‡æ¡£å®Œå–„ã€‚

