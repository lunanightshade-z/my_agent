# 模型配置化改造

## 修改时间
2026-01-27

## 修改目标
将 Chat 和 Agent 页面的模型列表和默认模型配置化，方便后续维护和修改。

## 修改内容

### 1. 创建模型配置文件 (`frontend/src/config/models.js`)

创建统一的模型配置文件，包含：

#### Chat 页面模型配置
- `CHAT_MODELS`: Chat 页面可用模型列表
- `CHAT_DEFAULT_MODEL`: Chat 页面默认模型 ID（设置为 `'bytedance-seed/seed-1.6-flash'`）

#### Agent 页面模型配置
- `AGENT_MODELS`: Agent 页面可用模型列表（所有模型均支持工具调用）
- `AGENT_DEFAULT_MODEL`: Agent 页面默认模型 ID（保持为 `'qwen3-235b'`）

#### 工具函数
- `findModelById(modelId, models)`: 根据模型 ID 查找模型配置
- `getChatDefaultModel()`: 获取 Chat 默认模型配置
- `getAgentDefaultModel()`: 获取 Agent 默认模型配置

### 2. 修改 ModelSelector 组件 (`frontend/src/components/ModelSelector.jsx`)

**修改前**：
- 模型列表硬编码在组件内部
- 默认模型硬编码为 `models[1]`（Kimi）

**修改后**：
- 从配置文件导入 `CHAT_MODELS` 和 `getChatDefaultModel`
- 使用 `findModelById` 查找当前模型
- 如果找不到则使用 `getChatDefaultModel()` 获取默认模型

```javascript
import { CHAT_MODELS, getChatDefaultModel, findModelById } from '../config/models';

const models = CHAT_MODELS;
const currentModel = findModelById(modelProvider, models) || getChatDefaultModel();
```

### 3. 修改 AgentModelSelector 组件 (`frontend/src/components/AgentModelSelector.jsx`)

**修改前**：
- 模型列表硬编码在组件内部
- 默认模型硬编码为 `models[0]`（Qwen）

**修改后**：
- 从配置文件导入 `AGENT_MODELS` 和 `getAgentDefaultModel`
- 使用 `findModelById` 查找当前模型
- 如果找不到则使用 `getAgentDefaultModel()` 获取默认模型

```javascript
import { AGENT_MODELS, getAgentDefaultModel, findModelById } from '../config/models';

const models = AGENT_MODELS;
const currentModel = findModelById(modelProvider, models) || getAgentDefaultModel();
```

### 4. 更新 Redux Store (`frontend/src/store/store.js`)

**修改前**：
```javascript
modelProvider: 'qwen3-235b',  // 硬编码默认模型
```

**修改后**：
```javascript
import { CHAT_DEFAULT_MODEL } from '../config/models';

modelProvider: CHAT_DEFAULT_MODEL,  // 从配置文件读取
```

### 5. 更新 AppLayout 组件 (`frontend/src/components/layout/AppLayout.jsx`)

**修改前**：
```javascript
modelProvider || 'qwen3-235b',  // 硬编码后备模型
```

**修改后**：
```javascript
import { CHAT_DEFAULT_MODEL } from '../../config/models';

modelProvider || CHAT_DEFAULT_MODEL,  // 从配置文件读取
```

### 6. 更新 Agent 页面 (`frontend/src/pages/Agent.jsx`)

**修改前**：
```javascript
const AGENT_DEFAULT_MODEL = 'qwen3-235b';  // 硬编码常量

if (!modelProvider || modelProvider === 'moonshotai/kimi-k2.5') {
  dispatch(setModelProvider(AGENT_DEFAULT_MODEL));
}
```

**修改后**：
```javascript
import { AGENT_DEFAULT_MODEL, AGENT_MODELS } from '../config/models';

// 检查当前模型是否在 Agent 模型列表中
const isAgentModel = AGENT_MODELS.some(m => m.id === modelProvider);
if (!modelProvider || !isAgentModel) {
  dispatch(setModelProvider(AGENT_DEFAULT_MODEL));
}
```

## 配置说明

### 如何修改默认模型

#### Chat 页面默认模型
编辑 `frontend/src/config/models.js`：
```javascript
export const CHAT_DEFAULT_MODEL = 'bytedance-seed/seed-1.6-flash';  // 修改为你想要的模型 ID
```

#### Agent 页面默认模型
编辑 `frontend/src/config/models.js`：
```javascript
export const AGENT_DEFAULT_MODEL = 'qwen3-235b';  // 修改为你想要的模型 ID
```

### 如何添加新模型

#### 添加 Chat 模型
在 `CHAT_MODELS` 数组中添加新模型对象：
```javascript
{
  id: 'new-model-id',
  name: 'New Model',
  provider: 'openrouter',
  icon: Sparkles,
  description: 'New Model Description',
  color: 'from-blue-500 to-cyan-500',
  category: 'OpenRouter',
}
```

#### 添加 Agent 模型
在 `AGENT_MODELS` 数组中添加新模型对象（必须设置 `supportsTools: true`）：
```javascript
{
  id: 'new-agent-model-id',
  name: 'New Agent Model',
  provider: 'openrouter',
  icon: Brain,
  description: 'New Agent Model Description',
  color: 'from-green-500 to-emerald-500',
  category: 'OpenRouter',
  supportsTools: true,  // Agent 模型必须支持工具调用
}
```

### 如何移除模型

直接从对应的模型数组中删除模型对象即可。

## 默认模型设置

### Chat 页面
- **默认模型**: `bytedance-seed/seed-1.6-flash` (Seed 1.6)
- **原因**: 用户要求将 Chat 默认模型改为 Seed 1.6

### Agent 页面
- **默认模型**: `qwen3-235b` (Qwen 235B)
- **原因**: 保持原有默认模型，用户未指定新的默认模型
- **注意**: 如需修改，请编辑 `frontend/src/config/models.js` 中的 `AGENT_DEFAULT_MODEL` 常量

## 技术亮点

1. **配置集中管理**: 所有模型配置集中在一个文件中，便于维护
2. **类型安全**: 使用工具函数确保模型查找的安全性
3. **向后兼容**: 如果找不到模型，自动回退到默认模型
4. **易于扩展**: 添加新模型只需修改配置文件
5. **代码复用**: 工具函数可在多个组件中复用

## 文件清单

### 新增文件
- `frontend/src/config/models.js` - 模型配置文件

### 修改文件
- `frontend/src/components/ModelSelector.jsx` - Chat 模型选择器
- `frontend/src/components/AgentModelSelector.jsx` - Agent 模型选择器
- `frontend/src/store/store.js` - Redux Store
- `frontend/src/components/layout/AppLayout.jsx` - Chat 页面布局
- `frontend/src/pages/Agent.jsx` - Agent 页面

## 测试结果

- ✅ 前端构建成功 (`npm run build`)
- ✅ Docker 重新部署成功
- ✅ Chat 页面默认模型已设置为 Seed 1.6
- ✅ Agent 页面默认模型保持 Qwen 235B
- ✅ 模型选择器正常工作
- ✅ 配置文件导入正确

## 后续优化建议

1. **环境变量支持**: 可以考虑通过环境变量覆盖默认模型配置
2. **用户偏好保存**: 可以将用户选择的模型保存到 localStorage
3. **模型可用性检测**: 可以添加模型可用性检测功能
4. **模型分组优化**: 可以进一步优化模型的分组和排序逻辑
